<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>訂餐與住宿統計表</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #dddddd;
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>訂餐與住宿統計表</h1>
    <table>
      <thead>
        <tr>
          <th> </th>
          <th><input type="text" class="form-control" value="4/1" onchange="updateDate(this, 0)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/2" onchange="updateDate(this, 1)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/3" onchange="updateDate(this, 2)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/8" onchange="updateDate(this, 3)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/9" onchange="updateDate(this, 4)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/10" onchange="updateDate(this, 5)" style="width: 80px;"></th>
          <th><input type="text" class="form-control" value="4/11" onchange="updateDate(this, 6)" style="width: 80px;"></th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Rows will be populated by JavaScript -->
      </tbody>
    </table>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Define the rows data
      const rowsData = [
        { title: '受訓-新進人員', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '受訓-新進人員(線上)', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '受訓-業務人員(旁聽)', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '住宿 -', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '行銷+行政(含珊珊)', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '受邀講師', values: [0, 0, 0, 0, 0, 0, 0] },
        { title: '不在人員(請填上姓名及特殊備註)', values: [0, 0, 0, 0, 0, 0, 0] }
      ];

      // Generate <select> element with numeric options
      function generateSelect(selected = 0) {
        let select = '<select class="form-control" onchange="calculateTotal(this)">';
        for (let i = 0; i <= 10; i++) {
          select += `<option value="${i}" ${i === selected ? 'selected' : ''}>${i}</option>`;
        }
        select += '</select>';
        return select;
      }

      // Generate <select> element with city options
      function generateCitySelect() {
        const cities = ['台北', '台中', '高雄'];
        let select = '<select class="form-control">';
        cities.forEach(city => {
          select += `<option value="${city}">${city}</option>`;
        });
        select += '</select>';
        return select;
      }

      // Populate the table with rows data
      const tbody = document.getElementById('table-body');
      rowsData.forEach(rowData => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${rowData.title}</td>
          ${rowData.values.map(value => `<td>${generateSelect(value)}</td>`).join('')}
        `;
        tbody.appendChild(row);
      });

      // Add the total row
      const totalRow = document.createElement('tr');
      totalRow.innerHTML = `
        <td><strong>total 人數</strong></td>
        ${Array(7).fill('<td><strong>0</strong></td>').join('')}
      `;
      tbody.appendChild(totalRow);

      // Add the city selection row
      const cityRow = document.createElement('tr');
      cityRow.innerHTML = `
        <td><strong>Location</strong></td>
        ${Array(7).fill(`<td>${generateCitySelect()}</td>`).join('')}
      `;
      tbody.appendChild(cityRow);

      // Initial calculation of totals
      document.querySelectorAll('select').forEach(select => calculateTotal(select));
    });

    // Calculate total for each column
    function calculateTotal(selectElement) {
      const table = selectElement.closest('table');
      const tbody = table.querySelector('tbody');
      const totalRow = tbody.querySelector('tr:nth-last-of-type(2)');

      for (let colIndex = 1; colIndex <= 7; colIndex++) {
        let total = 0;
        tbody.querySelectorAll('tr:not(:nth-last-of-type(2)):not(:nth-last-of-type(1))').forEach(row => {
          const select = row.children[colIndex].querySelector('select');
          total += parseInt(select.value) || 0;
        });
        totalRow.children[colIndex].innerText = total;
      }
    }

    // Update column header date
    function updateDate(inputElement, colIndex) {
      const table = inputElement.closest('table');
      table.querySelectorAll('thead th')[colIndex + 1].innerText = inputElement.value;
    }
  </script>
</body>
</html>
